//*****************************************************************************
//*****************************************************************************
//*                                                                           *
//*  TEXT - T_BIGNUM : show big number in text mode screen                    *
//*                                                                           *
//*****************************************************************************
//*****************************************************************************
//
// 20  21  22  23  24  25  26  27  28  29  2A  2B  2C  2D  2E  2F
//     !   "   #   $   %   &   '   (   )   *   +   ,   -   .   /
// ... .@. @.@ @.@ .@@ @.. .@. .@. ..@ @.. ... ... ... ... ... ...
// ... .@. @.@ @@@ @@. ..@ @.@ .@. .@. .@. @.@ .@. ... ... ... ..@
// ... .@. ... @.@ .@@ .@. .@. ... .@. .@. .@. @@@ ... @@@ ... .@.
// ... ... ... @@@ @@. @.. @.@ ... .@. .@. @.@ .@. .@. ... ... @..
// ... .@. ... @.@ .@. ..@ .@@ ... ..@ @.. ... ... @.. ... .@. ...

//   : 0000 0000 0000 0000 = 0x0000
// ! : 0100 1001 0000 0100 = 0x4904
// " : 1011 0100 0000 0000 = 0xB400
// # : 1011 1110 1111 1010 = 0xBEFA
// $ : 0111 1001 1110 0100 = 0x79E4
// % : 1000 0101 0100 0010 = 0x8542
// & : 0101 0101 0101 0110 = 0x5556
// ' : 0100 1000 0000 0000 = 0x4800
// ( : 0010 1001 0010 0010 = 0x2922
// ) : 1000 1001 0010 1000 = 0x8928
// * : 0001 0101 0101 0000 = 0x1550
// + : 0000 1011 1010 0000 = 0x0BA0
// , : 0000 0000 0010 1000 = 0x0028
// - : 0000 0011 1000 0000 = 0x0380
// . : 0000 0000 0000 0100 = 0x0004
// / : 0000 0101 0100 0000 = 0x0540

// 30  31  32  33  34  35  36  37  38  39  3A  3B  3C  3D  3E  3F
// 0   1   2   3   4   5   6   7   8   9   :   ;   <   =   >   ?
// @@@ .@. @@@ @@@ @.@ @@@ @@@ @@@ @@@ @@@ ... ... ..@ ... @.. @@@
// @.@ .@. ..@ ..@ @.@ @.. @.. ..@ @.@ @.@ .@. .@. .@. @@@ .@. ..@
// @.@ .@. @@@ .@@ @@@ @@@ @@@ ..@ @@@ @@@ ... ... @.. ... ..@ .@.
// @.@ .@. @.. ..@ ..@ ..@ @.@ ..@ @.@ ..@ .@. .@. .@. @@@ .@. ...
// @@@ .@. @@@ @@@ ..@ @@@ @@@ ..@ @@@ @@@ ... @.. ..@ ... @.. .@.

// 0 : 1111 0110 1101 1110 = 0xF6DE
// 1 : 0100 1001 0010 0100 = 0x4924
// 2 : 1110 0111 1100 1110 = 0xE7CE
// 3 : 1110 0101 1001 1110 = 0xE59E
// 4 : 1011 0111 1001 0010 = 0xB792
// 5 : 1111 0011 1001 1110 = 0xF39E
// 6 : 1111 0011 1101 1110 = 0xF3DE
// 7 : 1110 0100 1001 0010 = 0xE492
// 8 : 1111 0111 1101 1110 = 0xF7DE
// 9 : 1111 0111 1001 1110 = 0xF79E
// : : 0000 1000 0010 0000 = 0x0820
// ; : 0000 1000 0010 1000 = 0x0828
// < : 0010 1010 0010 0010 = 0x2A22
// = : 0001 1100 0111 0000 = 0x1C70
// > : 1000 1000 1010 1000 = 0x88A8
// ? : 1110 0101 0000 0100 = 0xE504

// 40  41  42  43  44  45  46  47  48  49  4A  4B  4C  4D  4E  4F
// @   A   B   C   D   E   F   G   H   I   J   K   L   M   N   O
// .@. .@. @@. .@@ @@. @@@ @@@ .@@ @.@ @@@ ..@ @.@ @.. @.@ @.@ .@.
// @.@ @.@ @.@ @.. @.@ @.. @.. @.. @.@ .@. ..@ @.@ @.. @@@ @@@ @.@
// @@@ @@@ @@. @.. @.@ @@@ @@@ @@@ @@@ .@. ..@ @@. @.. @@@ @@@ @.@
// @.. @.@ @.@ @.. @.@ @.. @.. @.@ @.@ .@. @.@ @.@ @.. @.@ @@@ @.@
// .@@ @.@ @@. .@@ @@. @@@ @.. .@@ @.@ @@@ .@. @.@ @@@ @.@ @.@ .@.

// @ : 0101 0111 1100 0110 = 0x57C6
// A : 0101 0111 1101 1010 = 0x57DA
// B : 1101 0111 0101 1100 = 0xD75C
// C : 0111 0010 0100 0110 = 0x7246
// D : 1101 0110 1101 1100 = 0xD6DC
// E : 1111 0011 1100 1110 = 0xF3CE
// F : 1111 0011 1100 1000 = 0xF3C8
// G : 0111 0011 1101 0110 = 0x73D6
// H : 1011 0111 1101 1010 = 0xB7DA
// I : 1110 1001 0010 1110 = 0xE92E
// J : 0010 0100 1101 0100 = 0x24D4
// K : 1011 0111 0101 1010 = 0xB75A
// L : 1001 0010 0100 1110 = 0x924E
// M : 1011 1111 1101 1010 = 0xBFDA
// N : 1011 1111 1111 1010 = 0xBFFA
// O : 0101 0110 1101 0100 = 0x56D4

// 50  51  52  53  54  55  56  57  58  59  5A  5B  5C  5D  5E  5F
// P   Q   R   S   T   U   V   W   X   Y   Z   [   \   ]   ^   _
// @@. .@. @@. .@@ @@@ @.@ @.@ @.@ @.@ @.@ @@@ @@@ ... @@@ .@. ...
// @.@ @.@ @.@ @.. .@. @.@ @.@ @.@ @.@ @.@ ..@ @.. @.. ..@ @.@ ...
// @@. @.@ @@@ .@. .@. @.@ @.@ @@@ .@. .@. .@. @.. .@. ..@ ... ...
// @.. @@@ @@. ..@ .@. @.@ .@. @@@ @.@ .@. @.. @.. ..@ ..@ ... ...
// @.. .@@ @.@ @@. .@. .@@ .@. @.@ @.@ .@. @@@ @@@ ... @@@ ... @@@

// P : 1101 0111 0100 1000 = 0xD748
// Q : 0101 0110 1111 0110 = 0x56F6
// R : 1101 0111 1110 1010 = 0xD7EA
// S : 0111 0001 0001 1100 = 0x711C
// T : 1110 1001 0010 0100 = 0xE924
// U : 1011 0110 1101 0110 = 0xB6D6
// V : 1011 0110 1010 0100 = 0xB6A4
// W : 1011 0111 1111 1010 = 0xB7FA
// X : 1011 0101 0101 1010 = 0xB55A
// Y : 1011 0101 0010 0100 = 0xB524
// Z : 1110 0101 0100 1110 = 0xE54E
// [ : 1111 0010 0100 1110 = 0xF24E
// \ : 0001 0001 0001 0000 = 0x1110
// ] : 1110 0100 1001 1110 = 0xE49E
// ^ : 0101 0100 0000 0000 = 0x5400
// _ : 0000 0000 0000 1110 = 0x000E

// 60  61  62  63  64  65  66  67  68  69  6A  6B  6C  6D  6E  6F
// `   a   b   c   d   e   f   g   h   i   j   k   l   m   n   o
// @.. ... @.. ... ..@ ... ..@ ... @.. .@. ..@ ... @@. ... ... ...
// .@. ... @.. ... ..@ .@@ .@. .@@ @.. ... ... @.. .@. ... ... ...
// ... .@@ @@. .@@ .@@ @.@ @@@ @@@ @@. .@. ..@ @.@ .@. @@@ @@. .@.
// ... @.@ @.@ @.. @.@ @@. .@. ..@ @.@ .@. ..@ @@. .@. @@@ @.@ @.@
// ... @@@ @@. .@@ .@@ .@@ .@. @@. @.@ .@. @@. @.@ @@@ @.@ @.@ .@.

// ` : 1000 1000 0000 0000 = 0x8800
// a : 0000 0001 1101 1110 = 0x01DE
// b : 1001 0011 0101 1100 = 0x935C
// c : 0000 0001 1100 0110 = 0x01C6
// d : 0010 0101 1101 0110 = 0x25D6
// e : 0000 1110 1110 0110 = 0x0EE6
// f : 0010 1011 1010 0100 = 0x2BA4
// g : 0000 1111 1001 1100 = 0x0F9C
// h : 1001 0011 0101 1010 = 0x935A
// i : 0100 0001 0010 0100 = 0x4124
// j : 0010 0000 1001 1100 = 0x209C
// k : 0001 0010 1110 1010 = 0x12EA
// l : 1100 1001 0010 1110 = 0xC92E
// m : 0000 0011 1111 1010 = 0x03FA
// n : 0000 0011 0101 1010 = 0x035A
// o : 0000 0001 0101 0100 = 0x0154

// 70  71  72  73  74  75  76  77  78  79  7A  7B  7C  7D  7E  7F
// p   q   r   s   t   u   v   w   x   y   z   {   |    }  ~      
// ... ... ... ... .@. ... ... ... ... ... ... .@@ .@. @@. .@@ @@@
// .@. .@. @.. .@@ @@@ ... ... ... ... @.@ @@@ .@. .@. .@. @@. @@@
// @.@ @.@ @@@ @@. .@. @.@ @.@ @.@ @.@ .@@ .@@ @.. ... ..@ ... @@@
// @@. .@@ @.. .@@ .@. @.@ @@@ @@@ .@. ..@ @@. .@. .@. .@. ... @@@
// @.. ..@ @.. @@. .@@ .@@ .@. @@@ @.@ @@. @@@ .@@ .@. @@. ... @@@

// p : 0000 1010 1110 1000 = 0x0AE8
// q : 0000 1010 1011 0010 = 0x0AB2
// r : 0001 0011 1100 1000 = 0x13C8
// s : 0000 1111 0011 1100 = 0x0F3C
// t : 0101 1101 0010 0110 = 0x5D26
// u : 0000 0010 1101 0110 = 0x02D6
// v : 0000 0010 1111 0100 = 0x02F4
// w : 0000 0010 1111 1110 = 0x02FE
// x : 0000 0010 1010 1010 = 0x02AA
// y : 0001 0101 1001 1100 = 0x159C
// z : 0001 1101 1110 1110 = 0x1DEE
// { : 0110 1010 0010 0110 = 0x6A26
// | : 0100 1000 0010 0100 = 0x4824
// } : 1100 1000 1010 1100 = 0xC8AC
// ~ : 0111 1000 0000 0000 = 0x7800
//   : 1111 1111 1111 1110 = 0xFFFE


// @@@ .@. @@@  @@@  @.@  @@@  @@@  @@@  @@@  @@@  @@@  @..  @@@  ..@  @@@  @@@  ...
// @.@ .@. ..@  ..@  @.@  @..  @..  ..@  @.@  @.@  @.@  @..  @..  ..@  @..  @..  ...
// @.@ .@. @@@  @@@  @@@  @@@  @@@  ..@  @@@  @@@  @@@  @@@  @..  @@@  @@@  @@@  ...
// @.@ .@. @..  ..@  ..@  ..@  @.@  ..@  @.@  ..@  @.@  @.@  @..  @.@  @..  @..  ...
// @@@ .@. @@@  @@@  ..@  @@@  @@@  ..@  @@@  @@@  @.@  @@@  @@@  @@@  @@@  @..  .@

// Font size : width * height = 3 * 5

//*****************************************************************************
#include <stdio.h>
#include <string.h>

#include "typedef.h"
#include "t_video.h"
#include "t_bignum.h"

//=============================================================================
//  t_big_ascii_bitmap
//=============================================================================
uint16_t	t_big_ascii_bitmap[128] =
{
	// 00~0F
	0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE,
	0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE,
	// 10~1F
	0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE,
	0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE, 0xF6DE,
	// 20~2F
	0x0000, 0x4904, 0xB400, 0xBEFA, 0x79E4, 0x8542, 0x5556, 0x4800,
	0x2922, 0x8928, 0x1550, 0x0BA0, 0x0028, 0x0380, 0x0004, 0x0540,
	// 30~3F
	0xF6DE, 0x4924, 0xE7CE, 0xE59E, 0xB792, 0xF39E, 0xF3DE, 0xE492,
	0xF7DE, 0xF79E, 0x0820, 0x0828, 0x2A22, 0x1C70, 0x88A8, 0xE504,
	// 40~4F
	0x57C6, 0x57DA, 0xD75C, 0x7246, 0xD6DC, 0xF3CE, 0xF3C8, 0x73D6,
	0xB7DA, 0xE92E, 0x24D4, 0xB75A, 0x924E, 0xBFDA, 0xBFFA, 0x56D4,
	// 50~5F
	0xD748, 0x56F6, 0xD7EA, 0x711C, 0xE924, 0xB6D6, 0xB6A4, 0xB7FA,
	0xB55A, 0xB524, 0xE54E, 0xF24E, 0x1110, 0xE49E, 0x5400, 0x000E,
	// 60~6F
	0x8800, 0x01DE, 0x935C, 0x01C6, 0x25D6, 0x0EE6, 0x2BA4, 0x0F9C,
	0x935A, 0x4124, 0x209C, 0x12EA, 0xC92E, 0x03FA, 0x035A, 0x0154,
	// 70~7F
	0x0AE8, 0x0AB2, 0x13C8, 0x0F3C, 0x5D26, 0x02D6, 0x02F4, 0x02FE,
	0x02AA, 0x159C, 0x1DEE, 0x6A26, 0x4824, 0xC8AC, 0x7800, 0xFFFE
};

//=============================================================================
//  t_big_num_bitmap
//=============================================================================
uint16_t	t_big_num_bitmap[16] =
{
	0xF6DE, 0x4924, 0xE7CE, 0xE79E, 0xB792, 0xF39E, 0xF3DE, 0xE492,
	0xF7DE, 0xF79E, 0xF7DA, 0x93DE, 0xF24E, 0x27DE, 0xF3CE, 0xF3C8
};

//=============================================================================
//  t_show_big_hex
//=============================================================================
void t_show_big_hex(t_big_num_t *bn)
{
	int			i, j, c, d;
	int			ax;		// align x
	uint16_t	mask;
	char		msg[4];
	int			digits;
	int			off;
	uint32_t	nmask;
	uint8_t		bk;

	bk = t_get_color();

	t_color(bn->fg, bn->bg);

	if (bn->num == 0)
	{
		digits = 1;
	}
	else
	{
		for (nmask=0xF0000000, digits=8; nmask >= 0xF; nmask >>= 4, digits--)
		{
			if (bn->num & nmask)
				break;
		}
	}

	ax = 0;

	// pad0
	if (bn->pad0 == T_BIGNUM_PAD0_EN)
	{
		if (bn->digit && digits < bn->digit)
		{
			c = 0;
			for (d=0; d<(bn->digit-digits); d++)
			{
				for (j=0, mask=0x8000; j<5; j++)
				{
					for (i=0; i<3; i++)
					{
						if (t_big_num_bitmap[ c ] & mask)
						{
							msg[i] = 0xb2;
						}
						else
						{
							msg[i] = 0x20;
						}
						mask >>= 1;
					}
					msg[3] = 0;
					t_xy_puts(bn->x+d*4, bn->y+j, msg);
				}
			}
			
			ax = (bn->digit-digits) * 4;
		}
	}
	// no pad0
	else
	{
		if (bn->digit && bn->digit > digits)
		{
			if (bn->align == T_BIGNUM_ALIGN_RIGHT)
			{
				ax = (bn->digit - digits);
				ax *= 4;	// 4= 3 width, 1 digit gap
			}
		}
	}

	
	for (off=(digits-1)*4, d=0; off>=0; off-=4, d++)
	{
		c = (bn->num>>off) & 0xF;

		for (j=0, mask=0x8000; j<5; j++)
		{
			for (i=0; i<3; i++)
			{
				if (t_big_num_bitmap[ c ] & mask)
				{
					msg[i] = 0xb2;
				}
				else
				{
					msg[i] = 0x20;
				}
				mask >>= 1;
			}
			msg[3] = 0;
			t_xy_puts(bn->x+d*4+ax, bn->y+j, msg);
		}
	}

	t_set_color(bk);
}

//=============================================================================
//  t_show_big_dec
//=============================================================================
void t_show_big_dec(t_big_num_t *bn)
{
	int			i, j, d;
	int			ax;		// align x
	uint16_t	mask;
	char		msg[4];
	int			digits;
	uint32_t	off;
	uint32_t	c, val;
	uint8_t		bk;

	bk = t_get_color();

	t_color(bn->fg, bn->bg);
	
	for (digits=1, off=bn->num; ; digits++)
	{
		off /= 10;
		if (off == 0)
			break;
	}

	ax = 0;

	// pad0
	if (bn->pad0 == T_BIGNUM_PAD0_EN)
	{
		if (bn->digit && digits < bn->digit)
		{
			c = 0;
			ax = 0;
			for (d=0; d<(bn->digit-digits); d++)
			{
				for (j=0, mask=0x8000; j<5; j++)
				{
					for (i=0; i<3; i++)
					{
						if (t_big_num_bitmap[ c ] & mask)
						{
							msg[i] = 0xb2;
						}
						else
						{
							msg[i] = 0x20;
						}
						mask >>= 1;
					}
					msg[3] = 0;
					t_xy_puts(bn->x+d*4+ax, bn->y+j, msg);
				}
			}
			
			ax = (bn->digit-digits) * 4;
		}
	}
	// no pad0
	else
	{
		if (bn->digit && bn->digit >= digits)
		{
			if (bn->align == T_BIGNUM_ALIGN_RIGHT)
			{
				ax = (bn->digit - digits);
				ax *= 4;	// 4= 3 width, 1 digit gap
			}
		}
	}
	
	// uint32 max : 2^32 - 1 = 4,294,967,295

	val = bn->num;
	for (d=0; d<digits; d++)
	{
		for(j=0, off=1; j<(digits-d-1); j++)
			off *= 10;
		//off /= 10;
		
		c = val/off;
		val -= c*off;

		for (j=0, mask=0x8000; j<5; j++)
		{
			for (i=0; i<3; i++)
			{
				if (t_big_num_bitmap[ c ] & mask)
				{
					msg[i] = 0xb2;
				}
				else
				{
					msg[i] = 0x20;
				}
				mask >>= 1;
			}
			msg[3] = 0;
			t_xy_puts(bn->x+d*4+ax, bn->y+j, msg);
		}
	}

	t_set_color(bk);
}

//=============================================================================
//  t_show_big_chr
//=============================================================================
void t_show_big_chr(t_big_num_t *bn)
{
	int			i, j;
	int			ax;		// align x
	uint16_t	mask;
	char		msg[4];
	uint32_t	c;
	uint8_t		bk;

	bk = t_get_color();

	t_color(bn->fg, bn->bg);
	
	ax = 0;

	c = bn->num;

	for (j=0, mask=0x8000; j<5; j++)
	{
		for (i=0; i<3; i++)
		{
			if (t_big_ascii_bitmap[ c ] & mask)
			{
				msg[i] = 0xb2;
			}
			else
			{
				msg[i] = 0x20;
			}
			mask >>= 1;
		}
		msg[3] = 0;
		t_xy_puts(bn->x+ax, bn->y+j, msg);
	}
		
	t_set_color(bk);
}

//=============================================================================
//  t_show_big_str
//=============================================================================
void t_show_big_str(t_big_num_t *bn, char *str)
{
	int			i, j, k;
	int			ax;		// align x
	uint16_t	mask;
	char		msg[4];
	uint32_t	c;
	uint8_t		bk;
	int			len = (int)strlen(str);
	char		*s;

	bk = t_get_color();

	t_color(bn->fg, bn->bg);
	
	for (k=0, s=str; k<len; k++)
	{
		c = *s++;
		ax = k*4;

		for (j=0, mask=0x8000; j<5; j++)
		{
			for (i=0; i<3; i++)
			{
				if (t_big_ascii_bitmap[ c ] & mask)
				{
					msg[i] = 0xb2;
				}
				else
				{
					msg[i] = 0x20;
				}
				mask >>= 1;
			}
			msg[3] = 0;
			t_xy_puts(bn->x+ax, bn->y+j, msg);
		}
	}
		
	t_set_color(bk);
}
