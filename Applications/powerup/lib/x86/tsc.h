//*****************************************************************************
//*****************************************************************************
//*                                                                           *
//*  X86 - TSC (Time Stamp Counter)                                           *
//*                                                                           *
//*****************************************************************************
//*****************************************************************************
#ifndef __X86_TSC_H
#define __X86_TSC_H

#include "typedef.h"

//=============================================================================
//  rdtsc : __BORLANDC__
//=============================================================================
#ifdef __BORLANDC__
static void rdtsc(uint32_t *tsc)
{

	_asm {

		mov di, tsc;

		db 0x0f; db 0x31;			// rdtsc

		db 0x66; mov [di], ax;		// mov DWORD PTR [di], eax
		db 0x66; mov [di+4], dx;	// mov DWORD PTR [di+4], edx
	}
}
#endif

//=============================================================================
//  rdtsc : __WATCOMC__
//=============================================================================
#ifdef __WATCOMC__
static unsigned __int64 rdtsc(void)
{
	return AsmReadTsc();
}
//#pragma aux rdtsc =\
//	 0x0F 0x31 \
//	 value [edx eax] \
//	 parm nomemory 	 \
//	 modify exact [edx eax] \
//	 nomemory; 
#endif

//=============================================================================
//  functions
//=============================================================================

#endif
