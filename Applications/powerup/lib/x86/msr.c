//*****************************************************************************
//*****************************************************************************
//*                                                                           *
//*  MSR - Model-Specific Registers                                           *
//*                                                                           *
//*****************************************************************************
//*****************************************************************************
#include "typedef.h"

#ifdef __WATCOMC__

//=============================================================================
//  rdmsr_lsb
//=============================================================================
uint32_t rdmsr_lsb(uint32_t idx)
{
	uint32_t	data32 = 0;

	__asm
	{
		mov ecx, [idx]
		rdmsr
		mov [data32], eax
	}

	return data32;
}

//=============================================================================
//  rdmsr_msb
//=============================================================================
uint32_t rdmsr_msb(uint32_t idx)
{
	uint32_t	data32 = 0;

	__asm
	{
		mov ecx, [idx]
		rdmsr
		mov [data32], edx
	}

	return data32;
}

//=============================================================================
//  rdmsr
//=============================================================================
uint64_t rdmsr(uint32_t idx)
{
	uint32_t	msb = 0;
	uint32_t	lsb = 0;
	uint64_t	res = 0;

	__asm
	{
		mov ecx, [idx]
		rdmsr
		mov [msb], edx
		mov	[lsb], eax
	}

	res = (uint64_t)msb;
	res <<= 32;
	res |= (uint64_t)lsb;
	
	return res;
}

//=============================================================================
//  wrmsr
//=============================================================================
uint32_t wrmsr(uint32_t idx, uint32_t lsb, uint32_t msb)
{
	__asm
	{
		mov ecx, [idx]
		mov eax, [lsb]
		mov edx, [msb]
		wrmsr
	}

	return 0;
}

#endif
